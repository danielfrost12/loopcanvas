<!-- Onboarding Tips — Injected by Onboarding Optimizer -->
<div id="lc-onboarding-tips" style="display:none;">
  <style>
    .lc-tip-overlay {
      position: fixed;
      z-index: 9999;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    .lc-tip-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    .lc-tip-bubble {
      background: rgba(29,185,84,0.95);
      color: white;
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      line-height: 1.4;
      padding: 12px 16px;
      border-radius: 12px;
      max-width: 280px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      position: relative;
    }
    .lc-tip-bubble::after {
      content: '';
      position: absolute;
      bottom: -6px;
      left: 24px;
      width: 12px;
      height: 12px;
      background: rgba(29,185,84,0.95);
      transform: rotate(45deg);
    }
    .lc-tip-dismiss {
      display: inline-block;
      margin-top: 8px;
      font-size: 11px;
      opacity: 0.7;
      cursor: pointer;
      pointer-events: auto;
    }
    .lc-tip-dismiss:hover { opacity: 1; }
    .lc-tip-step {
      font-size: 10px;
      opacity: 0.6;
      margin-bottom: 4px;
    }
  </style>
</div>
<script>
(function() {
  const TIPS = {
    'upload': {
      text: 'Drop any audio file here — MP3, WAV, FLAC all work. We analyze the mood automatically.',
      target: '.upload-zone, #upload-area, [data-upload]',
      step: '1 of 4'
    },
    'analyzing': {
      text: 'Our AI is listening to your track — detecting tempo, energy, mood, and emotional arc.',
      target: '.analysis-status, #analysis-progress',
      step: '2 of 4'
    },
    'directors': {
      text: 'Each director has a unique visual philosophy. Pick the one that matches your vision.',
      target: '.director-grid, #direction-picker',
      step: '3 of 4'
    },
    'generating': {
      text: 'Your canvas is being crafted. This takes about 20-30 seconds for the best quality.',
      target: '.generation-progress, #generate-status',
      step: '3 of 4'
    },
    'export': {
      text: 'Download your Spotify Canvas-ready video. It loops perfectly!',
      target: '.export-modal, #export-section',
      step: '4 of 4'
    }
  };

  window.lcShowTip = function(stage) {
    const tip = TIPS[stage];
    if (!tip) return;

    // Don't show if user dismissed tips
    if (localStorage.getItem('lc_tips_dismissed') === 'true') return;
    
    // Don't show same tip twice in a session
    const shown = JSON.parse(sessionStorage.getItem('lc_tips_shown') || '[]');
    if (shown.includes(stage)) return;

    // Remove existing tips
    document.querySelectorAll('.lc-tip-overlay').forEach(el => el.remove());

    const overlay = document.createElement('div');
    overlay.className = 'lc-tip-overlay';
    overlay.innerHTML = \`
      <div class="lc-tip-bubble">
        <div class="lc-tip-step">Step \${tip.step}</div>
        \${tip.text}
        <div class="lc-tip-dismiss" onclick="this.closest('.lc-tip-overlay').remove()">Got it ✓</div>
      </div>
    \`;

    // Position near target element
    const target = document.querySelector(tip.target);
    if (target) {
      const rect = target.getBoundingClientRect();
      overlay.style.position = 'fixed';
      overlay.style.top = (rect.top - 80) + 'px';
      overlay.style.left = rect.left + 'px';
    } else {
      overlay.style.position = 'fixed';
      overlay.style.bottom = '100px';
      overlay.style.left = '50%';
      overlay.style.transform = 'translateX(-50%)';
    }

    document.body.appendChild(overlay);
    requestAnimationFrame(() => overlay.classList.add('active'));

    shown.push(stage);
    sessionStorage.setItem('lc_tips_shown', JSON.stringify(shown));

    // Auto-dismiss after 8 seconds
    setTimeout(() => {
      if (overlay.parentNode) {
        overlay.classList.remove('active');
        setTimeout(() => overlay.remove(), 400);
      }
    }, 8000);
  };

  window.lcDismissAllTips = function() {
    localStorage.setItem('lc_tips_dismissed', 'true');
    document.querySelectorAll('.lc-tip-overlay').forEach(el => el.remove());
  };
})();
</script>
